<html>
<head>
  <meta charset="utf-8">
  <title>숫자야구</title>
</head>

<body>
  <form id="form">
    <input type="text" id="input">
    <button>확인</button>
  </form>
  <div id="logs"></div>

  <script>
    const $input = document.querySelector('#input');
    const $form = document.querySelector('#form');
    const $logs = document.querySelector('#logs');

    // 1. 정답 정하기.

    // 1 ~ 9 까지의 수를 배열로 뽑는다.
    const numbers = [];
    for (let n = 0; n < 9; n+=1){
      numbers.push(n+1);  // 1~9의 수를 뽑고 numbers에 push로 추가.
    }

    // numbers에서 랜덤으로 수 4개 뽑기.
    const answer = [];
    for (let n = 0; n < 4; n+=1){
      const index = Math.floor( Math.random() * (numbers.length - n) );
      answer.push(numbers[index]); //index로 뽑은 수와 같은값을 numbers에서 찾아 answer에 추가
      numbers.splice(index,1); // numbers에서 index와 같은값을 제거.
    }

    // 2. 시도하기

    const tries = [];
    function checkInput(input){  // 올바르지 않은 시도일 경우
      if (input.length !== 4) {
        return alert('4자리 숫자를 입력하세요.');//alert의 반환값은 false이므로 이후 if문의 false
      }
      if (new Set(input).size !== 4) {   // new Set으로 중복되지 않게 input의 새로운 배열을
        return alert('중복되지 않게 수를 입력해주세요.'); // 만든다.(중복된 수는 버려져서 4자리가 안됨)
      }
      return true;  //위의 if 문들에 전부 해당되지 않을경우 true를 반환해 줌으로써 이후 if문으로 진행가능.
    }

    // 3. 승패 결정하기

    // 3-1. 홈런인지 판단하기
    function loser(){ // 게임 오버 상황 함수
      const message = document.createTextNode('패배! 정답은 ' + answer.join('') + '입니다');
      // createTextNode는 textContent와 다르게 추가할때 밑줄에 써주면 된다.
      $logs.append(message);  // append로 $logs에 message를 추가한다.
    }

    let outCount = 0;   //outCount는 아래 함수 안에 넣으면 submit 할때마다 리셋되고 출력되기를 반복하기 때문에 빼준다.
    $form.addEventListener('submit',function(event){  // form은 submit이 click 같은개념
      event.preventDefault();         // form의 기본 새로고침 기능을 없애줌(저장한값 날아가서)
      const value = $input.value;   // value라는 변수에 input에 입력되있는 값 저장
      $input.value = '';          // input에 입력돼 있는 값을 지움(저장은 돼있으니까 다음 입력위해)
      if(!checkInput(value)){   // 에러 있음
        return;
      }
          //  에러 없음
        if (answer.join('') === value) { // join으로 배열인 answer를 문자열로 만든다.
          $logs.textContent = '홈런!~!~!~! 이 화면을 캡쳐하여 망고에게 보여주세요! 좋은일이 있을거에요!';
          return;
        }
        if (tries.length >= 7) { // 10번째 시도때 tries안에 9가 들어있다.
          loser();
          return;
        }
        // 3-2. 몇 스트라이크 몇 볼 인지 판단하기
        let strike = 0;
        let ball = 0;
        for (let i = 0; i < answer.length; i++) {
          const index = value.indexOf(answer[i]);
          // answer의 0번째 숫자가 value의 몇번째 자리인가를 index에 저장, 오류는 -1로 저장.
          if (index > -1) { //일치하는 숫자 발견, 오류는 -1로 나와서 -1보다 커야 진행.
            if (index === i) { // 자릿수도 같음, i가 value의 자리수와 같으면.
              strike += 1;
            }else {  // 숫자만 같고 자리는 다름. 다른자리 3곳에 있을때.
              ball += 1;
            }
          }
        }
        // 3-3. 아웃카운트 세기
        if (strike === 0 && ball === 0) {
          outCount ++;
          $logs.append(outCount + '아웃 !!', document.createElement('br'));
        }
        else {
          $logs.append(value + ' : ' + strike + '스트라이크 ' + ball + ' 볼 ', document.createElement('br'));
        }
        if (outCount === 3) {
          loser();
          return;
        }

      tries.push(value);  // 여기서 tries에 시도한게 추가된다.
    });
  </script>
</body>
